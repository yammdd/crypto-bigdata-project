#!/usr/bin/env python3
"""
Script to explain what the crypto predictions mean and their limitations
"""

import json
import requests
from datetime import datetime

def explain_predictions():
    """Explain what the predictions mean and their limitations"""
    print("ðŸ” Crypto Prediction Explanation")
    print("=" * 50)
    
    print("\nðŸ“Š WHAT IS 'predicted_price'?")
    print("   â€¢ It's a 1-DAY AHEAD forecast (tomorrow's predicted price)")
    print("   â€¢ Based on historical patterns and technical indicators")
    print("   â€¢ Generated by XGBoost machine learning model")
    print("   â€¢ Uses 8 years of daily price data")
    
    print("\nâš ï¸  WHY ARE PREDICTIONS OFTEN WRONG?")
    print("   â€¢ Crypto markets are HIGHLY VOLATILE and unpredictable")
    print("   â€¢ 1-day predictions are essentially short-term gambling")
    print("   â€¢ External factors (news, regulations, whale movements) aren't captured")
    print("   â€¢ Models work better for LONG-TERM trends than daily predictions")
    
    print("\nðŸŽ¯ WHAT SHOULD YOU EXPECT?")
    print("   â€¢ Predictions within Â±10% of current price = GOOD")
    print("   â€¢ Predictions within Â±20% of current price = ACCEPTABLE")
    print("   â€¢ Predictions >Â±50% different = MODEL ISSUE")
    print("   â€¢ Focus on DIRECTION (up/down) rather than exact price")
    
    print("\nðŸ“ˆ BETTER USE CASES FOR THESE MODELS:")
    print("   â€¢ Long-term trend analysis (weeks/months)")
    print("   â€¢ Risk assessment and volatility prediction")
    print("   â€¢ Technical indicator analysis")
    print("   â€¢ Portfolio diversification insights")
    
    print("\nðŸš« WHAT NOT TO USE THESE PREDICTIONS FOR:")
    print("   â€¢ Day trading decisions")
    print("   â€¢ Exact buy/sell timing")
    print("   â€¢ Financial advice")
    print("   â€¢ Guaranteed profit strategies")

def analyze_current_predictions():
    """Analyze current predictions and their reasonableness"""
    print("\n" + "=" * 50)
    print("ðŸ“Š CURRENT PREDICTION ANALYSIS")
    print("=" * 50)
    
    # Get current market prices
    try:
        symbols = {
            "btcusdt": "bitcoin",
            "ethusdt": "ethereum", 
            "solusdt": "solana",
            "bnbusdt": "binancecoin",
            "xrpusdt": "ripple"
        }
        
        ids = ",".join(symbols.values())
        url = f"https://api.coingecko.com/api/v3/simple/price?ids={ids}&vs_currencies=usd"
        response = requests.get(url, timeout=10)
        current_prices = response.json()
        
        print(f"\nðŸ“… Analysis Date: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
        
        for symbol in ["btcusdt", "ethusdt", "bnbusdt", "xrpusdt"]:
            print(f"\n--- {symbol.upper()} ---")
            
            try:
                # Read prediction
                with open(f"/opt/spark/work-dir/models/xgboost_{symbol}_prediction.json", "r") as f:
                    pred = json.load(f)
                
                predicted_price = pred['predicted_price']
                last_price = pred['last_price']
                prediction_change = pred['prediction_change_pct']
                confidence = pred.get('prediction_confidence', 'unknown')
                volatility_ratio = pred.get('volatility_ratio', 0)
                
                # Get current market price
                coingecko_id = symbols[symbol]
                current_price = current_prices.get(coingecko_id, {}).get('usd', None)
                
                print(f"   ðŸ’° Current Market: ${current_price:,.2f}" if current_price else "   ðŸ’° Current Market: N/A")
                print(f"   ðŸ“ˆ Last Price (in data): ${last_price:,.2f}")
                print(f"   ðŸ”® Predicted Price (tomorrow): ${predicted_price:,.2f}")
                print(f"   ðŸ“Š Prediction Change: {prediction_change:+.2f}%")
                print(f"   ðŸŽ¯ Confidence: {confidence}")
                print(f"   ðŸ“‰ Volatility Ratio: {volatility_ratio:.2%}")
                
                # Assess reasonableness
                if abs(prediction_change) < 5:
                    print(f"   âœ… REASONABLE: Small change prediction")
                elif abs(prediction_change) < 15:
                    print(f"   âš ï¸  MODERATE: Moderate change prediction")
                else:
                    print(f"   âŒ HIGH: Large change prediction - be cautious!")
                
                # Check if prediction is within reasonable bounds
                if current_price:
                    pred_vs_current = abs(predicted_price - current_price) / current_price * 100
                    if pred_vs_current < 10:
                        print(f"   âœ… GOOD: Prediction close to current market")
                    elif pred_vs_current < 25:
                        print(f"   âš ï¸  OKAY: Prediction moderately different from market")
                    else:
                        print(f"   âŒ POOR: Prediction very different from market")
                
            except FileNotFoundError:
                print(f"   âŒ Prediction file not found")
            except Exception as e:
                print(f"   âŒ Error: {e}")
    
    except Exception as e:
        print(f"âŒ Error fetching current prices: {e}")

def main():
    explain_predictions()
    analyze_current_predictions()
    
    print("\n" + "=" * 50)
    print("ðŸŽ¯ RECOMMENDATIONS")
    print("=" * 50)
    print("1. Use predictions for TREND ANALYSIS, not exact prices")
    print("2. Consider predictions as ONE factor among many")
    print("3. Focus on LONG-TERM patterns rather than daily predictions")
    print("4. Always do your own research before making investment decisions")
    print("5. Remember: Past performance doesn't guarantee future results")

if __name__ == "__main__":
    main()
